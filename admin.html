<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ù„ÙˆØ­Ø© Ø§Ù„Ø¥Ø¯Ø§Ø±Ø© | CoinFlow</title>
    <link rel="stylesheet" href="style.css">
    <style>
        .user-card { background: #111b21; border: 1px solid #222; padding: 15px; border-radius: 15px; margin-bottom: 20px; text-align: right; }
        .admin-chat { height: 200px; overflow-y: auto; background: #0b141a; padding: 10px; border-radius: 10px; margin: 10px 0; border: 1px solid #333; }
        .msg-text { font-size: 13px; margin-bottom: 5px; padding: 5px; border-bottom: 1px solid #1e293b; }
        .user-info { color: #00d2ff; font-weight: bold; border-bottom: 1px solid #333; padding-bottom: 5px; }
        button { width: auto; padding: 8px 15px; font-size: 12px; margin-left: 5px; }
        img { max-width: 120px; border-radius: 8px; margin: 5px 0; cursor: pointer; }
    </style>
</head>
<body>
    <div class="container" id="lock">
        <div class="glass-card" style="margin-top: 50px;">
            <h2>Ø¯Ø®ÙˆÙ„ Ø§Ù„Ù…Ø³Ø¤ÙˆÙ„</h2>
            <input type="password" id="pin" placeholder="Ø§Ù„Ø±Ù…Ø² Ø§Ù„Ø³Ø±ÙŠ">
            <button onclick="login()">Ø¯Ø®ÙˆÙ„</button>
        </div>
    </div>

    <div class="container" id="panel" style="display:none; max-width: 600px;">
        <h2 style="color:#00d2ff; margin-bottom:20px;">Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ø³ØªØ«Ù…Ø±ÙŠÙ†</h2>
        <div id="uList"></div>
    </div>

    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-auth.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>
    <script src="script.js"></script>
    <script>
        function login() {
            if(document.getElementById('pin').value === "30003100") {
                document.getElementById('lock').style.display='none';
                document.getElementById('panel').style.display='block';
                loadData();
            } else { alert("Ø§Ù„Ø±Ù…Ø² Ø®Ø·Ø£"); }
        }

        function loadData() {
            db.ref('users').on('value', s => {
                let h = '';
                s.forEach(u => {
                    const d = u.val(); const uid = u.key;
                    h += `<div class="user-card">
                        <div class="user-info">ðŸ‘¤ ${d.email || 'Ù…Ø³ØªØ®Ø¯Ù… Ø¬Ø¯ÙŠØ¯'} | ðŸ’° Ø§Ù„Ø±ØµÙŠØ¯: ${d.balance || 0}$</div>
                        <div class="admin-chat" id="chat-${uid}">Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø±Ø³Ø§Ø¦Ù„...</div>
                        <div style="display:flex; gap:5px;">
                            <input type="text" id="inp-${uid}" placeholder="Ø§ÙƒØªØ¨ Ø±Ø¯Ùƒ Ù‡Ù†Ø§..." style="margin:0; flex:1;">
                            <button onclick="reply('${uid}')">Ø±Ø¯</button>
                            <button onclick="setB('${uid}')" style="background:#f39c12;">ØªØ¹Ø¯ÙŠÙ„</button>
                        </div>
                    </div>`;
                    setTimeout(() => listen(uid), 100);
                });
                document.getElementById('uList').innerHTML = h;
            });
        }

        function listen(uid) {
            db.ref('users/'+uid+'/messages').on('value', s => {
                let h = '';
                s.forEach(m => {
                    const d = m.val();
                    const color = d.s === 'u' ? '#00d2ff' : '#00ff00';
                    const name = d.s === 'u' ? 'Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…' : 'Ø£Ù†Øª';
                    const content = d.type === 'image' ? `<img src="${d.t}" onclick="window.open(this.src)">` : d.t;
                    h += `<div class="msg-text"><span style="color:${color}">${name}:</span> ${content}</div>`;
                });
                const cb = document.getElementById('chat-'+uid);
                if(cb) { cb.innerHTML = h; cb.scrollTop = cb.scrollHeight; }
            });
        }

        function reply(uid) {
            const t = document.getElementById('inp-'+uid).value;
            if(t) {
                db.ref('users/'+uid+'/messages').push({ s:'a', t:t, type:'text', time:Date.now() });
                document.getElementById('inp-'+uid).value = '';
            }
        }

        function setB(uid) {
            let n = prompt("Ø£Ø¯Ø®Ù„ Ø§Ù„Ø±ØµÙŠØ¯ Ø§Ù„Ø¬Ø¯ÙŠØ¯ Ø¨Ø§Ù„Ø¯ÙˆÙ„Ø§Ø±:");
            if(n) db.ref('users/'+uid).update({ balance: parseFloat(n) });
        }
    </script>
</body>
</html>