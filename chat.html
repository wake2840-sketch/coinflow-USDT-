<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ø§Ù„Ø¯Ø±Ø¯Ø´Ø© Ø§Ù„Ù…Ø¨Ø§Ø´Ø±Ø©</title>
    <link rel="stylesheet" href="style.css">
    <style>
        #chatBox { height: 70vh; overflow-y: auto; display: flex; flex-direction: column; padding: 10px; background: #0b141a; }
        .msg { margin: 5px; padding: 10px; border-radius: 12px; max-width: 80%; font-size: 14px; color: white; }
        .u { align-self: flex-start; background: #005c4b; border-top-left-radius: 0; }
        .a { align-self: flex-end; background: #202c33; border-top-right-radius: 0; }
        img { max-width: 100%; border-radius: 10px; margin-top: 5px; }
        .input-chat { display: flex; gap: 5px; background: #202c33; padding: 10px; }
    </style>
</head>
<body>
    <div class="container" style="padding:0;">
        <div id="chatBox"></div>
        <div class="input-chat">
            <label style="cursor:pointer; font-size:25px;">ðŸ“Ž<input type="file" id="fInp" hidden onchange="upImg(this)"></label>
            <input type="text" id="mInp" placeholder="Ø§ÙƒØªØ¨ Ø±Ø³Ø§Ù„ØªÙƒ..." style="flex:1; margin:0;">
            <button onclick="send()" style="width:auto; margin:0;">Ø§Ø±Ø³Ø§Ù„</button>
        </div>
        <button onclick="location.href='dashboard.html'" style="background:#444;">Ø±Ø¬ÙˆØ¹</button>
    </div>

    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-auth.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>
    <script src="script.js"></script>
    <script>
        function send() {
            const t = document.getElementById('mInp').value;
            const u = firebase.auth().currentUser;
            if(t && u) {
                db.ref('users/'+u.uid+'/messages').push({ s:'u', t:t, type:'text', time: Date.now() });
                document.getElementById('mInp').value = '';
            }
        }
        function upImg(input) {
            const file = input.files[0];
            const u = firebase.auth().currentUser;
            if(file && u) {
                const reader = new FileReader();
                reader.onload = e => db.ref('users/'+u.uid+'/messages').push({ s:'u', t:e.target.result, type:'image', time: Date.now() });
                reader.readAsDataURL(file);
            }
        }
        firebase.auth().onAuthStateChanged(user => {
            if(user) {
                db.ref('users/'+user.uid+'/messages').on('value', s => {
                    let h = '';
                    s.forEach(m => {
                        const d = m.val();
                        const cont = d.type === 'image' ? `<img src="${d.t}">` : d.t;
                        h += `<div class="msg ${d.s}">${cont}</div>`;
                    });
                    const cb = document.getElementById('chatBox');
                    cb.innerHTML = h; cb.scrollTop = cb.scrollHeight;
                });
            }
        });
    </script>
</body>
</html>